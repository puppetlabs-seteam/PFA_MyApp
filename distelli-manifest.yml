seteam/PFA_MyApp:
  # This Basic Distelli Manifest assumes the following
  # has been provisioned on the destination deploy server: 

  PkgInclude:
    - 'Boltdir/'
    - 'myapp/'
  PreInstall:
    - 'sudo yum clean all'
    - 'sudo rpm -Uvh https://yum.puppet.com/puppet6/puppet6-release-el-7.noarch.rpm || true'
    - 'sudo yum install -y puppet-bolt'
    - 'sudo yum install -y jq'
  PostInstall:
    - 'sudo /usr/local/bin/bolt puppetfile install'
    - 'sudo /usr/local/bin/bolt plan run myapp::prereqs --run-as root'
    - 'sudo rm -rf /var/www/myapp/*'
    - 'sudo cp -rf myapp/* /var/www/myapp'
    - 'sudo /usr/local/bin/bolt plan run myapp::webhost --run-as root'
  Start:
    - 'sudo /bin/systemctl restart php-fpm'
    - 'sudo /bin/systemctl restart nginx'
  PostStart:
    - 'appurl=$(/opt/puppetlabs/bolt/bin/facter --json ec2_metadata | jq -r ''.["ec2_metadata"]["public-hostname"]'') || true'
    - 'echo "****************************************************************"'
    - 'echo     "This app started on: http://$appurl"'
    - 'echo "****************************************************************"'
